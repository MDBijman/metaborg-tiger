module cfg

language tiger

test stringescape [[
"\\"
]] parse to Mod(String("\"\\\""))

test dead variables [[
let
	var x: int := 10
in
     (print(x)
    ; x := 11
    ; x := 12
    ; print(x))
end
]] run flock-test-show-cfg to "digraph G { graph[rankdir=LR, center=true, margin=0.2, nodesep=0.1, ranksep=0.3]; node[shape=record];17[label=\"<f0>|<f1>17|<f2>7.0|<f3>Assign(Var(...),Int(...))\"];17->25;3[label=\"<f0>|<f1>3|<f2>3.0|<f3>VarDec(\\"x\\",Tid(...),Int(...))\"];3->15;20[label=\"<f0>|<f1>20|<f2>6.0|<f3>Int(\\"11\\")\"];20->17;22[label=\"<f0>|<f1>22|<f2>9.0|<f3>Assign(Var(...),Int(...))\"];22->30;7[label=\"<f0>r|<f1>7|<f2>2.0|<f3>Int(\\"10\\")\"];7->3;25[label=\"<f0>|<f1>25|<f2>8.0|<f3>Int(\\"12\\")\"];25->22;27[label=\"<f0>l|<f1>27|<f2>11.0|<f3>Call(\\"print\\",[...])\"];12[label=\"<f0>|<f1>12|<f2>5.0|<f3>Call(\\"print\\",[...])\"];12->20;30[label=\"<f0>|<f1>30|<f2>10.0|<f3>Var(\\"x\\")\"];30->27;15[label=\"<f0>|<f1>15|<f2>4.0|<f3>Var(\\"x\\")\"];15->12;} "

test fact [[
let
    function nfactor(n: int): int =
      if n = 0 then 1 else (n * nfactor(n-1))

	var x: int := 10
in
    nfactor(x)
end
]] run flock-test-show-cfg to "digraph G { graph[rankdir=LR, center=true, margin=0.2, nodesep=0.1, ranksep=0.3]; node[shape=record];33[label=\"<f0>|<f1>33|<f2>11.0|<f3>Int(\\"1\\")\"];33->30;35[label=\"<f0>|<f1>35|<f2>3.0|<f3>VarDec(\\"x\\",Tid(...),Int(...))\"];35->45;39[label=\"<f0>r|<f1>39|<f2>2.0|<f3>Int(\\"10\\")\"];39->35;42[label=\"<f0>l|<f1>42|<f2>5.0|<f3>Call(\\"nfactor\\",[...])\"];45[label=\"<f0>|<f1>45|<f2>4.0|<f3>Var(\\"x\\")\"];45->42;15[label=\"<f0>|<f1>15|<f2>8.0|<f3>Eq(Var(...),Int(...))\"];15->20;15->25;16[label=\"<f0>r|<f1>16|<f2>6.0|<f3>Var(\\"n\\")\"];16->18;18[label=\"<f0>|<f1>18|<f2>7.0|<f3>Int(\\"0\\")\"];18->15;20[label=\"<f0>l|<f1>20|<f2>15.0|<f3>Int(\\"1\\")\"];24[label=\"<f0>l|<f1>24|<f2>14.0|<f3>Times(Var(...),Call(...))\"];25[label=\"<f0>|<f1>25|<f2>9.0|<f3>Var(\\"n\\")\"];25->31;27[label=\"<f0>|<f1>27|<f2>13.0|<f3>Call(\\"nfactor\\",[...])\"];27->24;30[label=\"<f0>|<f1>30|<f2>12.0|<f3>Minus(Var(...),Int(...))\"];30->27;31[label=\"<f0>|<f1>31|<f2>10.0|<f3>Var(\\"n\\")\"];31->33;} "

test fact inlined [[
let
  function nfactor(n : int) : int =
    if n = 0 then
      1
    else
      n * nfactor(n - 1)
  var x : int := 10
 in
  let
    var n : int := 10
   in
    if n = 0 then
      1
    else
      n * let
            var n : int := n - 1
           in
            if n = 0 then
              1
            else
              n * let
                    var n : int := n - 1
                   in
                    if n = 0 then
                      1
                    else
                      n * let
                            var n : int := n - 1
                           in
                            if n = 0 then
                              1
                            else
                              n * let
                                    var n : int := n - 1
                                   in
                                    if n = 0 then
                                      1
                                    else
                                      n * let
                                            var n : int := n - 1
                                           in
                                            if n = 0 then
                                              1
                                            else
                                              n * let
                                                    var n : int := n - 1
                                                   in
                                                    if n = 0 then
                                                      1
                                                    else
                                                      n * let
                                                            var n : int := n - 1
                                                           in
                                                            if n = 0 then
                                                              1
                                                            else
                                                              n * let
                                                                    var n : int := n - 1
                                                                   in
                                                                    if n = 0 then
                                                                      1
                                                                    else
                                                                      n * let
                                                                            var n : int := n - 1
                                                                           in
                                                                            if n = 0 then
                                                                              1
                                                                            else
                                                                              n * let
                                                                                    var n : int := n - 1
                                                                                   in
                                                                                    if n = 0 then
                                                                                      1
                                                                                    else
                                                                                      n * let
                                                                                            var n : int := n - 1
                                                                                           in
                                                                                            if n = 0 then
                                                                                              1
                                                                                            else
                                                                                              n * let
                                                                                                    var n : int := n - 1
                                                                                                   in
                                                                                                    if n = 0 then
                                                                                                      1
                                                                                                    else
                                                                                                      n * let
                                                                                                            var n : int := n - 1
                                                                                                           in
                                                                                                            if n = 0 then
                                                                                                              1
                                                                                                            else
                                                                                                              n * let
                                                                                                                    var n : int := n - 1
                                                                                                                   in
                                                                                                                    if n = 0 then
                                                                                                                      1
                                                                                                                    else
                                                                                                                      n * nfactor(n - 1)
                                                                                                                  end
                                                                                                          end
                                                                                                  end
                                                                                          end
                                                                                  end
                                                                          end
                                                                  end
                                                          end
                                                  end
                                          end
                                  end
                          end
                  end
          end
  end
end
]] run flock-test-show-cfg to "digraph G { graph[rankdir=LR, center=true, margin=0.2, nodesep=0.1, ranksep=0.3]; node[shape=record];257[label=\"<f0>|<f1>257|<f2>82.0|<f3>Eq(Var(...),Int(...))\"];257->262;257->265;258[label=\"<f0>|<f1>258|<f2>80.0|<f3>Var(\\"n\\")\"];258->260;260[label=\"<f0>|<f1>260|<f2>81.0|<f3>Int(\\"0\\")\"];260->257;262[label=\"<f0>|<f1>262|<f2>139.0|<f3>Int(\\"1\\")\"];262->241;264[label=\"<f0>|<f1>264|<f2>138.0|<f3>Times(Var(...),Let(...))\"];264->241;265[label=\"<f0>|<f1>265|<f2>83.0|<f3>Var(\\"n\\")\"];265->274;269[label=\"<f0>|<f1>269|<f2>87.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];269->281;15[label=\"<f0>|<f1>15|<f2>158.0|<f3>Eq(Var(...),Int(...))\"];15->20;15->23;16[label=\"<f0>r|<f1>16|<f2>156.0|<f3>Var(\\"n\\")\"];16->18;273[label=\"<f0>|<f1>273|<f2>86.0|<f3>Minus(Var(...),Int(...))\"];273->269;18[label=\"<f0>|<f1>18|<f2>157.0|<f3>Int(\\"0\\")\"];18->15;274[label=\"<f0>|<f1>274|<f2>84.0|<f3>Var(\\"n\\")\"];274->276;20[label=\"<f0>l|<f1>20|<f2>165.0|<f3>Int(\\"1\\")\"];276[label=\"<f0>|<f1>276|<f2>85.0|<f3>Int(\\"1\\")\"];276->273;22[label=\"<f0>l|<f1>22|<f2>164.0|<f3>Times(Var(...),Call(...))\"];23[label=\"<f0>|<f1>23|<f2>159.0|<f3>Var(\\"n\\")\"];23->29;280[label=\"<f0>|<f1>280|<f2>90.0|<f3>Eq(Var(...),Int(...))\"];280->288;280->285;25[label=\"<f0>|<f1>25|<f2>163.0|<f3>Call(\\"nfactor\\",[...])\"];25->22;281[label=\"<f0>|<f1>281|<f2>88.0|<f3>Var(\\"n\\")\"];281->283;283[label=\"<f0>|<f1>283|<f2>89.0|<f3>Int(\\"0\\")\"];283->280;28[label=\"<f0>|<f1>28|<f2>162.0|<f3>Minus(Var(...),Int(...))\"];28->25;29[label=\"<f0>|<f1>29|<f2>160.0|<f3>Var(\\"n\\")\"];29->31;285[label=\"<f0>|<f1>285|<f2>91.0|<f3>Int(\\"1\\")\"];285->264;31[label=\"<f0>|<f1>31|<f2>161.0|<f3>Int(\\"1\\")\"];31->28;287[label=\"<f0>|<f1>287|<f2>137.0|<f3>Times(Var(...),Let(...))\"];287->264;288[label=\"<f0>|<f1>288|<f2>92.0|<f3>Var(\\"n\\")\"];288->297;33[label=\"<f0>|<f1>33|<f2>3.0|<f3>VarDec(\\"x\\",Tid(...),Int(...))\"];33->46;292[label=\"<f0>|<f1>292|<f2>96.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];292->304;37[label=\"<f0>r|<f1>37|<f2>2.0|<f3>Int(\\"10\\")\"];37->33;296[label=\"<f0>|<f1>296|<f2>95.0|<f3>Minus(Var(...),Int(...))\"];296->292;297[label=\"<f0>|<f1>297|<f2>93.0|<f3>Var(\\"n\\")\"];297->299;42[label=\"<f0>|<f1>42|<f2>5.0|<f3>VarDec(\\"n\\",Tid(...),Int(...))\"];42->51;299[label=\"<f0>|<f1>299|<f2>94.0|<f3>Int(\\"1\\")\"];299->296;46[label=\"<f0>|<f1>46|<f2>4.0|<f3>Int(\\"10\\")\"];46->42;303[label=\"<f0>|<f1>303|<f2>99.0|<f3>Eq(Var(...),Int(...))\"];303->308;303->311;304[label=\"<f0>|<f1>304|<f2>97.0|<f3>Var(\\"n\\")\"];304->306;50[label=\"<f0>|<f1>50|<f2>8.0|<f3>Eq(Var(...),Int(...))\"];50->55;50->58;306[label=\"<f0>|<f1>306|<f2>98.0|<f3>Int(\\"0\\")\"];306->303;51[label=\"<f0>|<f1>51|<f2>6.0|<f3>Var(\\"n\\")\"];51->53;308[label=\"<f0>|<f1>308|<f2>136.0|<f3>Int(\\"1\\")\"];308->287;53[label=\"<f0>|<f1>53|<f2>7.0|<f3>Int(\\"0\\")\"];53->50;310[label=\"<f0>|<f1>310|<f2>135.0|<f3>Times(Var(...),Let(...))\"];310->287;55[label=\"<f0>l|<f1>55|<f2>155.0|<f3>Int(\\"1\\")\"];311[label=\"<f0>|<f1>311|<f2>100.0|<f3>Var(\\"n\\")\"];311->320;57[label=\"<f0>l|<f1>57|<f2>154.0|<f3>Times(Var(...),Let(...))\"];58[label=\"<f0>|<f1>58|<f2>9.0|<f3>Var(\\"n\\")\"];58->67;315[label=\"<f0>|<f1>315|<f2>104.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];315->327;62[label=\"<f0>|<f1>62|<f2>13.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];62->74;319[label=\"<f0>|<f1>319|<f2>103.0|<f3>Minus(Var(...),Int(...))\"];319->315;320[label=\"<f0>|<f1>320|<f2>101.0|<f3>Var(\\"n\\")\"];320->322;66[label=\"<f0>|<f1>66|<f2>12.0|<f3>Minus(Var(...),Int(...))\"];66->62;322[label=\"<f0>|<f1>322|<f2>102.0|<f3>Int(\\"1\\")\"];322->319;67[label=\"<f0>|<f1>67|<f2>10.0|<f3>Var(\\"n\\")\"];67->69;69[label=\"<f0>|<f1>69|<f2>11.0|<f3>Int(\\"1\\")\"];69->66;326[label=\"<f0>|<f1>326|<f2>107.0|<f3>Eq(Var(...),Int(...))\"];326->331;326->334;327[label=\"<f0>|<f1>327|<f2>105.0|<f3>Var(\\"n\\")\"];327->329;73[label=\"<f0>|<f1>73|<f2>16.0|<f3>Eq(Var(...),Int(...))\"];73->81;73->78;329[label=\"<f0>|<f1>329|<f2>106.0|<f3>Int(\\"0\\")\"];329->326;74[label=\"<f0>|<f1>74|<f2>14.0|<f3>Var(\\"n\\")\"];74->76;331[label=\"<f0>|<f1>331|<f2>134.0|<f3>Int(\\"1\\")\"];331->310;76[label=\"<f0>|<f1>76|<f2>15.0|<f3>Int(\\"0\\")\"];76->73;333[label=\"<f0>|<f1>333|<f2>133.0|<f3>Times(Var(...),Let(...))\"];333->310;78[label=\"<f0>|<f1>78|<f2>17.0|<f3>Int(\\"1\\")\"];78->57;334[label=\"<f0>|<f1>334|<f2>108.0|<f3>Var(\\"n\\")\"];334->343;80[label=\"<f0>|<f1>80|<f2>153.0|<f3>Times(Var(...),Let(...))\"];80->57;81[label=\"<f0>|<f1>81|<f2>18.0|<f3>Var(\\"n\\")\"];81->90;338[label=\"<f0>|<f1>338|<f2>112.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];338->350;85[label=\"<f0>|<f1>85|<f2>22.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];85->97;342[label=\"<f0>|<f1>342|<f2>111.0|<f3>Minus(Var(...),Int(...))\"];342->338;343[label=\"<f0>|<f1>343|<f2>109.0|<f3>Var(\\"n\\")\"];343->345;89[label=\"<f0>|<f1>89|<f2>21.0|<f3>Minus(Var(...),Int(...))\"];89->85;345[label=\"<f0>|<f1>345|<f2>110.0|<f3>Int(\\"1\\")\"];345->342;90[label=\"<f0>|<f1>90|<f2>19.0|<f3>Var(\\"n\\")\"];90->92;92[label=\"<f0>|<f1>92|<f2>20.0|<f3>Int(\\"1\\")\"];92->89;349[label=\"<f0>|<f1>349|<f2>115.0|<f3>Eq(Var(...),Int(...))\"];349->354;349->357;350[label=\"<f0>|<f1>350|<f2>113.0|<f3>Var(\\"n\\")\"];350->352;96[label=\"<f0>|<f1>96|<f2>25.0|<f3>Eq(Var(...),Int(...))\"];96->101;96->104;352[label=\"<f0>|<f1>352|<f2>114.0|<f3>Int(\\"0\\")\"];352->349;97[label=\"<f0>|<f1>97|<f2>23.0|<f3>Var(\\"n\\")\"];97->99;354[label=\"<f0>|<f1>354|<f2>132.0|<f3>Int(\\"1\\")\"];354->333;99[label=\"<f0>|<f1>99|<f2>24.0|<f3>Int(\\"0\\")\"];99->96;356[label=\"<f0>|<f1>356|<f2>131.0|<f3>Times(Var(...),Let(...))\"];356->333;101[label=\"<f0>|<f1>101|<f2>152.0|<f3>Int(\\"1\\")\"];101->80;357[label=\"<f0>|<f1>357|<f2>116.0|<f3>Var(\\"n\\")\"];357->366;103[label=\"<f0>|<f1>103|<f2>151.0|<f3>Times(Var(...),Let(...))\"];103->80;104[label=\"<f0>|<f1>104|<f2>26.0|<f3>Var(\\"n\\")\"];104->113;361[label=\"<f0>|<f1>361|<f2>120.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];361->373;108[label=\"<f0>|<f1>108|<f2>30.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];108->120;365[label=\"<f0>|<f1>365|<f2>119.0|<f3>Minus(Var(...),Int(...))\"];365->361;366[label=\"<f0>|<f1>366|<f2>117.0|<f3>Var(\\"n\\")\"];366->368;112[label=\"<f0>|<f1>112|<f2>29.0|<f3>Minus(Var(...),Int(...))\"];112->108;368[label=\"<f0>|<f1>368|<f2>118.0|<f3>Int(\\"1\\")\"];368->365;113[label=\"<f0>|<f1>113|<f2>27.0|<f3>Var(\\"n\\")\"];113->115;115[label=\"<f0>|<f1>115|<f2>28.0|<f3>Int(\\"1\\")\"];115->112;372[label=\"<f0>|<f1>372|<f2>123.0|<f3>Eq(Var(...),Int(...))\"];372->377;372->380;373[label=\"<f0>|<f1>373|<f2>121.0|<f3>Var(\\"n\\")\"];373->375;119[label=\"<f0>|<f1>119|<f2>33.0|<f3>Eq(Var(...),Int(...))\"];119->124;119->127;375[label=\"<f0>|<f1>375|<f2>122.0|<f3>Int(\\"0\\")\"];375->372;120[label=\"<f0>|<f1>120|<f2>31.0|<f3>Var(\\"n\\")\"];120->122;377[label=\"<f0>|<f1>377|<f2>130.0|<f3>Int(\\"1\\")\"];377->356;122[label=\"<f0>|<f1>122|<f2>32.0|<f3>Int(\\"0\\")\"];122->119;379[label=\"<f0>|<f1>379|<f2>129.0|<f3>Times(Var(...),Call(...))\"];379->356;124[label=\"<f0>|<f1>124|<f2>150.0|<f3>Int(\\"1\\")\"];124->103;380[label=\"<f0>|<f1>380|<f2>124.0|<f3>Var(\\"n\\")\"];380->386;382[label=\"<f0>|<f1>382|<f2>128.0|<f3>Call(\\"nfactor\\",[...])\"];382->379;126[label=\"<f0>|<f1>126|<f2>149.0|<f3>Times(Var(...),Let(...))\"];126->103;127[label=\"<f0>|<f1>127|<f2>34.0|<f3>Var(\\"n\\")\"];127->136;385[label=\"<f0>|<f1>385|<f2>127.0|<f3>Minus(Var(...),Int(...))\"];385->382;386[label=\"<f0>|<f1>386|<f2>125.0|<f3>Var(\\"n\\")\"];386->388;131[label=\"<f0>|<f1>131|<f2>38.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];131->143;388[label=\"<f0>|<f1>388|<f2>126.0|<f3>Int(\\"1\\")\"];388->385;135[label=\"<f0>|<f1>135|<f2>37.0|<f3>Minus(Var(...),Int(...))\"];135->131;136[label=\"<f0>|<f1>136|<f2>35.0|<f3>Var(\\"n\\")\"];136->138;138[label=\"<f0>|<f1>138|<f2>36.0|<f3>Int(\\"1\\")\"];138->135;142[label=\"<f0>|<f1>142|<f2>41.0|<f3>Eq(Var(...),Int(...))\"];142->147;142->150;143[label=\"<f0>|<f1>143|<f2>39.0|<f3>Var(\\"n\\")\"];143->145;145[label=\"<f0>|<f1>145|<f2>40.0|<f3>Int(\\"0\\")\"];145->142;147[label=\"<f0>|<f1>147|<f2>148.0|<f3>Int(\\"1\\")\"];147->126;149[label=\"<f0>|<f1>149|<f2>147.0|<f3>Times(Var(...),Let(...))\"];149->126;150[label=\"<f0>|<f1>150|<f2>42.0|<f3>Var(\\"n\\")\"];150->159;154[label=\"<f0>|<f1>154|<f2>46.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];154->166;158[label=\"<f0>|<f1>158|<f2>45.0|<f3>Minus(Var(...),Int(...))\"];158->154;159[label=\"<f0>|<f1>159|<f2>43.0|<f3>Var(\\"n\\")\"];159->161;161[label=\"<f0>|<f1>161|<f2>44.0|<f3>Int(\\"1\\")\"];161->158;165[label=\"<f0>|<f1>165|<f2>49.0|<f3>Eq(Var(...),Int(...))\"];165->170;165->173;166[label=\"<f0>|<f1>166|<f2>47.0|<f3>Var(\\"n\\")\"];166->168;168[label=\"<f0>|<f1>168|<f2>48.0|<f3>Int(\\"0\\")\"];168->165;170[label=\"<f0>|<f1>170|<f2>146.0|<f3>Int(\\"1\\")\"];170->149;172[label=\"<f0>|<f1>172|<f2>145.0|<f3>Times(Var(...),Let(...))\"];172->149;173[label=\"<f0>|<f1>173|<f2>50.0|<f3>Var(\\"n\\")\"];173->182;177[label=\"<f0>|<f1>177|<f2>54.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];177->189;181[label=\"<f0>|<f1>181|<f2>53.0|<f3>Minus(Var(...),Int(...))\"];181->177;182[label=\"<f0>|<f1>182|<f2>51.0|<f3>Var(\\"n\\")\"];182->184;184[label=\"<f0>|<f1>184|<f2>52.0|<f3>Int(\\"1\\")\"];184->181;188[label=\"<f0>|<f1>188|<f2>57.0|<f3>Eq(Var(...),Int(...))\"];188->193;188->196;189[label=\"<f0>|<f1>189|<f2>55.0|<f3>Var(\\"n\\")\"];189->191;191[label=\"<f0>|<f1>191|<f2>56.0|<f3>Int(\\"0\\")\"];191->188;193[label=\"<f0>|<f1>193|<f2>144.0|<f3>Int(\\"1\\")\"];193->172;195[label=\"<f0>|<f1>195|<f2>143.0|<f3>Times(Var(...),Let(...))\"];195->172;196[label=\"<f0>|<f1>196|<f2>58.0|<f3>Var(\\"n\\")\"];196->205;200[label=\"<f0>|<f1>200|<f2>62.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];200->212;204[label=\"<f0>|<f1>204|<f2>61.0|<f3>Minus(Var(...),Int(...))\"];204->200;205[label=\"<f0>|<f1>205|<f2>59.0|<f3>Var(\\"n\\")\"];205->207;207[label=\"<f0>|<f1>207|<f2>60.0|<f3>Int(\\"1\\")\"];207->204;211[label=\"<f0>|<f1>211|<f2>65.0|<f3>Eq(Var(...),Int(...))\"];211->216;211->219;212[label=\"<f0>|<f1>212|<f2>63.0|<f3>Var(\\"n\\")\"];212->214;214[label=\"<f0>|<f1>214|<f2>64.0|<f3>Int(\\"0\\")\"];214->211;216[label=\"<f0>|<f1>216|<f2>142.0|<f3>Int(\\"1\\")\"];216->195;218[label=\"<f0>|<f1>218|<f2>141.0|<f3>Times(Var(...),Let(...))\"];218->195;219[label=\"<f0>|<f1>219|<f2>66.0|<f3>Var(\\"n\\")\"];219->228;223[label=\"<f0>|<f1>223|<f2>70.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];223->235;227[label=\"<f0>|<f1>227|<f2>69.0|<f3>Minus(Var(...),Int(...))\"];227->223;228[label=\"<f0>|<f1>228|<f2>67.0|<f3>Var(\\"n\\")\"];228->230;230[label=\"<f0>|<f1>230|<f2>68.0|<f3>Int(\\"1\\")\"];230->227;234[label=\"<f0>|<f1>234|<f2>73.0|<f3>Eq(Var(...),Int(...))\"];234->242;234->239;235[label=\"<f0>|<f1>235|<f2>71.0|<f3>Var(\\"n\\")\"];235->237;237[label=\"<f0>|<f1>237|<f2>72.0|<f3>Int(\\"0\\")\"];237->234;239[label=\"<f0>|<f1>239|<f2>74.0|<f3>Int(\\"1\\")\"];239->218;241[label=\"<f0>|<f1>241|<f2>140.0|<f3>Times(Var(...),Let(...))\"];241->218;242[label=\"<f0>|<f1>242|<f2>75.0|<f3>Var(\\"n\\")\"];242->251;246[label=\"<f0>|<f1>246|<f2>79.0|<f3>VarDec(\\"n\\",Tid(...),Minus(...))\"];246->258;250[label=\"<f0>|<f1>250|<f2>78.0|<f3>Minus(Var(...),Int(...))\"];250->246;251[label=\"<f0>|<f1>251|<f2>76.0|<f3>Var(\\"n\\")\"];251->253;253[label=\"<f0>|<f1>253|<f2>77.0|<f3>Int(\\"1\\")\"];253->250;} "

test nqueens [[
let
    var N := 8

    type intArray = array of int

    var row := intArray [ N ] of 0
    var col := intArray [ N ] of 0
    var diag1 := intArray [N+N-1] of 0
    var diag2 := intArray [N+N-1] of 0
    var debug := 0

    function printboard() =
        (for i := 0 to N - 1
    do (for j := 0 to N - 1 
        do print(if col[i] = j then " O" else " .");
        print("\n"));
          print("\n"))

    function try(c: int) = 
      (if debug = 0 then
        (for i := 0 to c do print(".")
      ; print("\n")
      ; flush())
    ; if c = N then
        printboard()
      else 
        for r := 0 to N - 1 do 
          if row[r] = 0 & diag1[r + c] = 0 & diag2[r + 7 - c] = 0 then 
              (row[r] := 1
            ;  diag1[r + c] := 1
            ;  diag2[r + 7 - c] := 1
            ;  col[c] := r
            ;  try(c + 1)
            ;  row[r] := 0
            ;  diag1[r + c] := 0
            ;  diag2[r + 7 - c] := 0))
  in try(0)
end
]] run flock-test-show-cfg to "digraph G { graph[rankdir=LR, center=true, margin=0.2, nodesep=0.1, ranksep=0.3]; node[shape=record];258[label=\"<f0>|<f1>258|<f2>45.0|<f3>Plus(Var(...),Int(...))\"];258->255;259[label=\"<f0>|<f1>259|<f2>45.0|<f3>Var(\\"c\\")\"];259->261;3[label=\"<f0>|<f1>3|<f2>3.0|<f3>VarDecNoType(\\"N\\",Int(...))\"];3->17;261[label=\"<f0>|<f1>261|<f2>45.0|<f3>Int(\\"1\\")\"];261->258;5[label=\"<f0>r|<f1>5|<f2>2.0|<f3>Int(\\"8\\")\"];5->3;263[label=\"<f0>|<f1>263|<f2>45.0|<f3>Assign(Subscript(...),Int(...))\"];263->280;269[label=\"<f0>|<f1>269|<f2>45.0|<f3>Int(\\"0\\")\"];269->263;13[label=\"<f0>|<f1>13|<f2>7.0|<f3>VarDecNoType(\\"row\\",Array(...))\"];13->25;271[label=\"<f0>|<f1>271|<f2>45.0|<f3>Assign(Subscript(...),Int(...))\"];271->294;15[label=\"<f0>|<f1>15|<f2>6.0|<f3>Array(\\"intArray\\",Var(...),Int(...))\"];15->13;17[label=\"<f0>|<f1>17|<f2>4.0|<f3>Var(\\"N\\")\"];17->19;19[label=\"<f0>|<f1>19|<f2>5.0|<f3>Int(\\"0\\")\"];19->15;21[label=\"<f0>|<f1>21|<f2>11.0|<f3>VarDecNoType(\\"col\\",Array(...))\"];21->35;23[label=\"<f0>|<f1>23|<f2>10.0|<f3>Array(\\"intArray\\",Var(...),Int(...))\"];23->21;280[label=\"<f0>|<f1>280|<f2>45.0|<f3>Int(\\"0\\")\"];280->271;25[label=\"<f0>|<f1>25|<f2>8.0|<f3>Var(\\"N\\")\"];25->27;282[label=\"<f0>|<f1>282|<f2>45.0|<f3>Assign(Subscript(...),Int(...))\"];282->166;27[label=\"<f0>|<f1>27|<f2>9.0|<f3>Int(\\"0\\")\"];27->23;29[label=\"<f0>|<f1>29|<f2>19.0|<f3>VarDecNoType(\\"diag1\\",Array(...))\"];29->49;31[label=\"<f0>|<f1>31|<f2>18.0|<f3>Array(\\"intArray\\",Minus(...),Int(...))\"];31->29;33[label=\"<f0>|<f1>33|<f2>16.0|<f3>Minus(Plus(...),Int(...))\"];33->41;34[label=\"<f0>|<f1>34|<f2>14.0|<f3>Plus(Var(...),Var(...))\"];34->39;35[label=\"<f0>|<f1>35|<f2>12.0|<f3>Var(\\"N\\")\"];35->37;37[label=\"<f0>|<f1>37|<f2>13.0|<f3>Var(\\"N\\")\"];37->34;294[label=\"<f0>|<f1>294|<f2>45.0|<f3>Int(\\"0\\")\"];294->282;39[label=\"<f0>|<f1>39|<f2>15.0|<f3>Int(\\"1\\")\"];39->33;41[label=\"<f0>|<f1>41|<f2>17.0|<f3>Int(\\"0\\")\"];41->31;297[label=\"<f0>l|<f1>297|<f2>31.0|<f3>Call(\\"try\\",[...])\"];43[label=\"<f0>|<f1>43|<f2>27.0|<f3>VarDecNoType(\\"diag2\\",Array(...))\"];43->59;300[label=\"<f0>|<f1>300|<f2>30.0|<f3>Int(\\"0\\")\"];300->297;45[label=\"<f0>|<f1>45|<f2>26.0|<f3>Array(\\"intArray\\",Minus(...),Int(...))\"];45->43;47[label=\"<f0>|<f1>47|<f2>24.0|<f3>Minus(Plus(...),Int(...))\"];47->55;48[label=\"<f0>|<f1>48|<f2>22.0|<f3>Plus(Var(...),Var(...))\"];48->53;49[label=\"<f0>|<f1>49|<f2>20.0|<f3>Var(\\"N\\")\"];49->51;51[label=\"<f0>|<f1>51|<f2>21.0|<f3>Var(\\"N\\")\"];51->48;53[label=\"<f0>|<f1>53|<f2>23.0|<f3>Int(\\"1\\")\"];53->47;55[label=\"<f0>|<f1>55|<f2>25.0|<f3>Int(\\"0\\")\"];55->45;57[label=\"<f0>|<f1>57|<f2>29.0|<f3>VarDecNoType(\\"debug\\",Int(...))\"];57->300;59[label=\"<f0>|<f1>59|<f2>28.0|<f3>Int(\\"0\\")\"];59->57;69[label=\"<f0>r|<f1>69|<f2>32.0|<f3>LoopBinding(Var(...),Int(...),Minus(...))\"];69->82;69->116;82[label=\"<f0>|<f1>82|<f2>32.0|<f3>LoopBinding(Var(...),Int(...),Minus(...))\"];82->100;82->111;92[label=\"<f0>|<f1>92|<f2>32.0|<f3>Call(\\"print\\",[...])\"];92->82;96[label=\"<f0>|<f1>96|<f2>32.0|<f3>Eq(Subscript(...),Var(...))\"];96->104;96->106;97[label=\"<f0>|<f1>97|<f2>32.0|<f3>Subscript(Var(...),Var(...))\"];97->102;98[label=\"<f0>|<f1>98|<f2>32.0|<f3>Var(\\"col\\")\"];98->97;100[label=\"<f0>|<f1>100|<f2>32.0|<f3>Var(\\"i\\")\"];100->98;102[label=\"<f0>|<f1>102|<f2>32.0|<f3>Var(\\"j\\")\"];102->96;104[label=\"<f0>|<f1>104|<f2>32.0|<f3>String(\\"\\\\" O\\\\"\\")\"];104->92;106[label=\"<f0>|<f1>106|<f2>32.0|<f3>String(\\"\\\\" .\\\\"\\")\"];106->92;108[label=\"<f0>|<f1>108|<f2>32.0|<f3>Call(\\"print\\",[...])\"];108->69;111[label=\"<f0>|<f1>111|<f2>32.0|<f3>String(\\"\\\\"\\\\n\\\\"\\")\"];111->108;113[label=\"<f0>l|<f1>113|<f2>34.0|<f3>Call(\\"print\\",[...])\"];116[label=\"<f0>|<f1>116|<f2>33.0|<f3>String(\\"\\\\"\\\\n\\\\"\\")\"];116->113;128[label=\"<f0>|<f1>128|<f2>37.0|<f3>Eq(Var(...),Int(...))\"];128->136;129[label=\"<f0>r|<f1>129|<f2>35.0|<f3>Var(\\"debug\\")\"];129->131;131[label=\"<f0>|<f1>131|<f2>36.0|<f3>Int(\\"0\\")\"];131->128;136[label=\"<f0>|<f1>136|<f2>38.0|<f3>LoopBinding(Var(...),Int(...),Var(...))\"];136->146;136->151;143[label=\"<f0>|<f1>143|<f2>38.0|<f3>Call(\\"print\\",[...])\"];143->136;146[label=\"<f0>|<f1>146|<f2>38.0|<f3>String(\\"\\\\".\\\\"\\")\"];146->143;148[label=\"<f0>|<f1>148|<f2>40.0|<f3>Call(\\"print\\",[...])\"];148->153;151[label=\"<f0>|<f1>151|<f2>39.0|<f3>String(\\"\\\\"\\\\n\\\\"\\")\"];151->148;153[label=\"<f0>|<f1>153|<f2>41.0|<f3>Call(\\"flush\\",[])\"];153->158;157[label=\"<f0>|<f1>157|<f2>44.0|<f3>Eq(Var(...),Var(...))\"];157->162;157->166;158[label=\"<f0>|<f1>158|<f2>42.0|<f3>Var(\\"c\\")\"];158->160;160[label=\"<f0>|<f1>160|<f2>43.0|<f3>Var(\\"N\\")\"];160->157;162[label=\"<f0>l|<f1>162|<f2>46.0|<f3>Call(\\"printboard\\",[])\"];166[label=\"<f0>l|<f1>166|<f2>45.0|<f3>LoopBinding(Var(...),Int(...),Minus(...))\"];166->183;177[label=\"<f0>|<f1>177|<f2>45.0|<f3>And(And(...),Eq(...))\"];177->220;178[label=\"<f0>|<f1>178|<f2>45.0|<f3>And(Eq(...),Eq(...))\"];178->204;179[label=\"<f0>|<f1>179|<f2>45.0|<f3>Eq(Subscript(...),Int(...))\"];179->192;180[label=\"<f0>|<f1>180|<f2>45.0|<f3>Subscript(Var(...),Var(...))\"];180->185;181[label=\"<f0>|<f1>181|<f2>45.0|<f3>Var(\\"row\\")\"];181->180;183[label=\"<f0>|<f1>183|<f2>45.0|<f3>Var(\\"r\\")\"];183->181;185[label=\"<f0>|<f1>185|<f2>45.0|<f3>Int(\\"0\\")\"];185->179;187[label=\"<f0>|<f1>187|<f2>45.0|<f3>Eq(Subscript(...),Int(...))\"];187->178;188[label=\"<f0>|<f1>188|<f2>45.0|<f3>Subscript(Var(...),Plus(...))\"];188->196;189[label=\"<f0>|<f1>189|<f2>45.0|<f3>Var(\\"diag1\\")\"];189->188;191[label=\"<f0>|<f1>191|<f2>45.0|<f3>Plus(Var(...),Var(...))\"];191->189;192[label=\"<f0>|<f1>192|<f2>45.0|<f3>Var(\\"r\\")\"];192->194;194[label=\"<f0>|<f1>194|<f2>45.0|<f3>Var(\\"c\\")\"];194->191;196[label=\"<f0>|<f1>196|<f2>45.0|<f3>Int(\\"0\\")\"];196->187;198[label=\"<f0>|<f1>198|<f2>45.0|<f3>Eq(Subscript(...),Int(...))\"];198->177;199[label=\"<f0>|<f1>199|<f2>45.0|<f3>Subscript(Var(...),Minus(...))\"];199->210;200[label=\"<f0>|<f1>200|<f2>45.0|<f3>Var(\\"diag2\\")\"];200->199;202[label=\"<f0>|<f1>202|<f2>45.0|<f3>Minus(Plus(...),Var(...))\"];202->200;203[label=\"<f0>|<f1>203|<f2>45.0|<f3>Plus(Var(...),Int(...))\"];203->208;204[label=\"<f0>|<f1>204|<f2>45.0|<f3>Var(\\"r\\")\"];204->206;206[label=\"<f0>|<f1>206|<f2>45.0|<f3>Int(\\"7\\")\"];206->203;208[label=\"<f0>|<f1>208|<f2>45.0|<f3>Var(\\"c\\")\"];208->202;210[label=\"<f0>|<f1>210|<f2>45.0|<f3>Int(\\"0\\")\"];210->198;214[label=\"<f0>|<f1>214|<f2>45.0|<f3>Assign(Subscript(...),Int(...))\"];214->231;220[label=\"<f0>|<f1>220|<f2>45.0|<f3>Int(\\"1\\")\"];220->214;222[label=\"<f0>|<f1>222|<f2>45.0|<f3>Assign(Subscript(...),Int(...))\"];222->245;231[label=\"<f0>|<f1>231|<f2>45.0|<f3>Int(\\"1\\")\"];231->222;233[label=\"<f0>|<f1>233|<f2>45.0|<f3>Assign(Subscript(...),Int(...))\"];233->253;245[label=\"<f0>|<f1>245|<f2>45.0|<f3>Int(\\"1\\")\"];245->233;247[label=\"<f0>|<f1>247|<f2>45.0|<f3>Assign(Subscript(...),Var(...))\"];247->259;253[label=\"<f0>|<f1>253|<f2>45.0|<f3>Var(\\"r\\")\"];253->247;255[label=\"<f0>|<f1>255|<f2>45.0|<f3>Call(\\"try\\",[...])\"];255->269;} "
